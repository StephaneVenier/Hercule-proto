<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Le Périple d'Hercule — Défis Équipe</title>
<style>
  :root{
    --bg:#f6edd4;
    --paper:#efe2c4;
    --ink:#2f2417;
    --frame:#8b6b46;
    --accent:#b32a2a;
    --shadow:0 12px 30px rgba(0,0,0,.18);
  }
  *,*:before,*:after{box-sizing:border-box}
  body{
    margin:0; background:radial-gradient(1200px 700px at 20% 0%, var(--bg), #eadbb6);
    color:var(--ink);
    font:16px/1.5 ui-serif, Georgia, 'Times New Roman', Times, serif;
  }
  header{padding:clamp(14px,2vw,28px) 16px; text-align:center;}
  .title{
    display:inline-block; font-variant:small-caps; font-weight:800;
    font-size:clamp(28px,4vw,48px);
    letter-spacing:.06em; padding:.35em .9em;
    border:3px solid rgba(47,36,23,.6);
    border-radius:16px;
    background:linear-gradient(180deg,#f7eacc,#ecdcb3);
    box-shadow: var(--shadow), inset 0 2px 0 rgba(255,255,255,.5);
  }
  .wrap{max-width:min(1100px,95vw); margin:0 auto 42px; padding:0 12px 28px;}
  .card{
    background:var(--paper); border:1px solid rgba(47,36,23,.25);
    border-radius:20px; padding:16px; box-shadow:var(--shadow);
  }
  .map-box{
    position:relative; width:100%;
    aspect-ratio: 1152/768; /* exact image ratio to avoid any shift */
    border-radius:14px; overflow:hidden; background:#d9caa6;
  }
  .map-img{
    position:absolute; inset:0; width:100%; height:100%;
    object-fit:fill; /* exact fit since container matches the ratio */
    image-rendering:auto; filter:contrast(1.05) saturate(1.05);
  }
  svg.route{ position:absolute; inset:0; width:100%; height:100%; }
  .overlay-path{ fill:none; stroke:rgba(179,42,42,.0); stroke-width:12; }
  .marker{
    position:absolute; width:18px; height:18px; border-radius:50%;
    background:var(--accent); border:3px solid #fff;
    box-shadow:0 2px 12px rgba(0,0,0,.35);
    transform:translate(-50%,-50%);
    transition:left .05s linear, top .05s linear;
  }
  .hud{ margin-top:16px; display:grid; grid-template-columns:1fr auto; gap:12px; align-items:center; }
  .range{
    appearance:none; width:100%; height:12px; border-radius:999px;
    background:repeating-linear-gradient(90deg,#d5c6a3 0 8px,#cbb78f 8px 16px);
    outline:none; box-shadow: inset 0 1px 2px rgba(0,0,0,.25);
  }
  .range::-webkit-slider-thumb{
    appearance:none; width:26px; height:26px; border-radius:50%;
    background:var(--accent); border:3px solid #fff; box-shadow:0 2px 10px rgba(0,0,0,.35);
  }
  .range::-moz-range-thumb{
    width:26px; height:26px; border-radius:50%; background:var(--accent);
    border:3px solid #fff; box-shadow:0 2px 10px rgba(0,0,0,.35);
  }
  .km{ min-width:140px; text-align:right; font-variant-numeric:tabular-nums; font-weight:700; }
  .note{ margin-top:6px; color:#6c5a42; font-size:.95rem; }
</style>
</head>
<body>
<header><div class="title">Le Périple d'Hercule</div></header>
<main class="wrap">
  <section class="card">
    <div class="map-box" id="map">
      <img class="map-img" src="periple-hercule.png" alt="Carte des Douze Travaux d'Hercule">
      <svg class="route" viewBox="0 0 1 1" preserveAspectRatio="none" aria-hidden="true">
        <polyline class="overlay-path" points="0.342,0.465 0.371,0.445 0.402,0.43 0.435,0.42 0.468,0.418 0.505,0.435 0.528,0.47 0.545,0.51 0.555,0.56 0.56,0.62 0.562,0.68 0.57,0.735 0.585,0.775 0.61,0.805 0.64,0.815 0.675,0.812 0.705,0.8 0.735,0.788 0.76,0.78"></polyline>
      </svg>
      <div class="marker" id="marker"></div>
    </div>
    <div class="hud">
      <input id="slider" class="range" type="range" min="0" max="1500" step="1" value="0">
      <div class="km"><span id="km">0</span> km / 1500</div>
    </div>
    <div class="note">Glissez la barre ou cliquez sur la carte&nbsp;: le point rouge suit la route.</div>
  </section>
</main>

<script>
const poly = [[0.342, 0.465], [0.371, 0.445], [0.402, 0.43], [0.435, 0.42], [0.468, 0.418], [0.505, 0.435], [0.528, 0.47], [0.545, 0.51], [0.555, 0.56], [0.56, 0.62], [0.562, 0.68], [0.57, 0.735], [0.585, 0.775], [0.61, 0.805], [0.64, 0.815], [0.675, 0.812], [0.705, 0.8], [0.735, 0.788], [0.76, 0.78]];
let segLen = [], cumLen = [0], total = 0;
for (let i=0;i<poly.length-1;i++) {
  const dx = poly[i+1][0]-poly[i][0], dy = poly[i+1][1]-poly[i][1];
  const L = Math.hypot(dx,dy);
  segLen.push(L); total += L; cumLen.push(total);
}

function pointAt(t) {
  const dist = t*total;
  for (let i=0;i<segLen.length;i++) {
    if (dist <= cumLen[i+1] || i === segLen.length-1) {
      const segT = (dist - cumLen[i]) / (segLen[i] || 1e-9);
      const x = poly[i][0] + (poly[i+1][0]-poly[i][0])*segT;
      const y = poly[i][1] + (poly[i+1][1]-poly[i][1])*segT;
      return [x,y];
    }
  }
  return poly[poly.length-1];
}

const slider = document.getElementById('slider');
const kmEl = document.getElementById('km');
const map = document.getElementById('map');
const marker = document.getElementById('marker');

function update() {
  const km = Number(slider.value);
  kmEl.textContent = km.toFixed(0);
  const t = km / Number(slider.max);
  const [nx,ny] = pointAt(t);
  const rect = map.getBoundingClientRect();
  marker.style.left = (nx*rect.width) + 'px';
  marker.style.top  = (ny*rect.height) + 'px';
}

slider.addEventListener('input', update);
window.addEventListener('load', update);
window.addEventListener('resize', update);

function setFromClient(x,y) {
  const r = map.getBoundingClientRect();
  const px = (x - r.left) / r.width;
  const py = (y - r.top) / r.height;
  let bestDist = 1e9, bestAlong = 0;
  for (let i=0;i<poly.length-1;i++) {
    const x1=poly[i][0], y1=poly[i][1], x2=poly[i+1][0], y2=poly[i+1][1];
    const vx=x2-x1, vy=y2-y1;
    const wx=px-x1, wy=py-y1;
    const c1 = vx*wx + vy*wy;
    const c2 = vx*vx + vy*vy;
    let t = c2>0? Math.max(0, Math.min(1, c1/c2)) : 0;
    const projx = x1 + vx*t, projy = y1 + vy*t;
    const d = Math.hypot(projx-px, projy-py);
    const along = cumLen[i] + segLen[i]*t;
    if (d < bestDist) { bestDist = d; bestAlong = along; }
  }
  const norm = bestAlong / total;
  slider.value = Math.round(norm * Number(slider.max));
  update();
}

map.addEventListener('pointerdown', (e)=>{ map.setPointerCapture(e.pointerId); setFromClient(e.clientX,e.clientY); });
map.addEventListener('pointermove', (e)=>{ if (e.pressure>0) setFromClient(e.clientX,e.clientY); });
</script>
</body>
</html>
