<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Le Périple d'Hercule — Défis Équipe</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Spécifique au module carte */
    .section.map {
      padding: 0;
      overflow: hidden;
    }
    .head { padding: 20px 20px 0; }
    .head .title .accent { color:#facc15; }
    .panel { padding: 20px; }
    .map-box {
      position: relative;
      width: 100%;
      aspect-ratio: 1152 / 768; /* ratio exact de l'image */
      background:#0a0a0b;
      border-bottom:1px solid var(--stroke);
    }
    .map-box img {
      position:absolute; inset:0;
      width:100%; height:100%;
      object-fit:fill; /* on garde l'exact ratio donc pas de déformation */
      filter: contrast(1.05) saturate(1.05);
      user-select:none; -webkit-user-drag:none; pointer-events:none;
    }
    svg.route { position:absolute; inset:0; width:100%; height:100%; }
    .overlay-path { fill:none; stroke:rgba(250,204,21,0.0); stroke-width:0.02; vector-effect: non-scaling-stroke; }
    .marker {
      position:absolute;
      width:18px;height:18px;border-radius:50%;
      background:#ef4444;border:3px solid #fff;
      box-shadow:0 2px 12px rgba(0,0,0,.45);
      transform: translate(-50%, -50%);
      transition: left .04s linear, top .04s linear;
      will-change: left, top;
    }
    .hud {
      display:grid; grid-template-columns: 1fr auto; gap:12px; align-items:center;
      padding: 16px 20px 24px;
      background:var(--panel); border-top:1px solid var(--stroke);
    }
    .hud .km { font-weight:900; color:#facc15; }
    /* Slider minimal sombre pour matcher le thème */
    input[type="range"]{
      appearance:none; width:100%; height:10px; border-radius:999px;
      background:#1c1c22; outline:none;
    }
    input[type="range"]::-webkit-slider-thumb{
      appearance:none; width:22px; height:22px; border-radius:50%;
      background:#facc15; border:2px solid #111827; cursor:pointer;
      box-shadow:0 2px 10px rgba(0,0,0,.35);
    }
    input[type="range"]::-moz-range-thumb{
      width:22px; height:22px; border-radius:50%;
      background:#facc15; border:2px solid #111827; cursor:pointer;
      box-shadow:0 2px 10px rgba(0,0,0,.35);
    }
  </style>
</head>
<body>
  <nav class="nav">
    <div class="row">
      <div class="brand">Hercule <span class="accent">Project</span></div>
      <div class="links">
        <a class="btn" href="index.html">Accueil</a>
        <a class="btn primary" href="#">Participer</a>
      </div>
    </div>
  </nav>

  <div class="wrap">
    <section class="hero">
      <h1 class="title">Le <span class="accent">Périple</span> d'Hercule</h1>
      <p class="lead">Additionnez les kilomètres de votre équipe pour suivre sa route légendaire, étape après étape.</p>
      <div class="cta-row">
        <a class="btn primary" href="#">Rejoindre une équipe</a>
        <a class="btn" href="#">Voir les classements</a>
      </div>
    </section>

    <section class="section map" aria-label="Carte du périple">
      <div class="map-box" id="mapBox">
        <img src="periple-hercule.png" alt="Carte des Douze Travaux d'Hercule">
        <!-- Overlay vectoriel pour caler précisément le marqueur -->
        <svg class="route" viewBox="0 0 1 1" preserveAspectRatio="none" aria-hidden="true">
          <polyline class="overlay-path" points="0.338,0.468 0.358,0.454 0.377,0.446 0.4,0.437 0.423,0.428 0.449,0.422 0.474,0.42 0.496,0.427 0.515,0.444 0.531,0.468 0.544,0.498 0.552,0.533 0.558,0.57 0.561,0.612 0.563,0.654 0.566,0.693 0.573,0.73 0.584,0.761 0.599,0.785 0.618,0.801 0.64,0.811 0.665,0.813 0.69,0.807 0.714,0.799 0.736,0.791 0.756,0.782"></polyline>
        </svg>
        <div class="marker" id="marker"></div>
      </div>
      <div class="hud">
        <input id="progress" type="range" min="0" max="1500" value="0" step="1" />
        <div class="km"><span id="kmVal">0</span> km / 1500</div>
      </div>
    </section>

    <section class="section">
      <div class="grid cols-2">
        <div class="step">
          <h3>Comment ça marche ?</h3>
          <p>Glissez la barre ci-dessus ou cliquez/drag directement sur la carte&nbsp;: le point rouge reste collé au trajet.</p>
        </div>
        <div class="step">
          <h3>Intégration</h3>
          <p>Remplacez la valeur du slider par la somme de votre équipe depuis votre API, et le marqueur avancera automatiquement.</p>
        </div>
      </div>
    </section>

    <footer>© Hercule Project — Défi collectif</footer>
  </div>

<script>
// Chemin polyline normalisé (0..1) pour coller exactement au tracé visible
const poly = [[0.338, 0.468], [0.358, 0.454], [0.377, 0.446], [0.4, 0.437], [0.423, 0.428], [0.449, 0.422], [0.474, 0.42], [0.496, 0.427], [0.515, 0.444], [0.531, 0.468], [0.544, 0.498], [0.552, 0.533], [0.558, 0.57], [0.561, 0.612], [0.563, 0.654], [0.566, 0.693], [0.573, 0.73], [0.584, 0.761], [0.599, 0.785], [0.618, 0.801], [0.64, 0.811], [0.665, 0.813], [0.69, 0.807], [0.714, 0.799], [0.736, 0.791], [0.756, 0.782]];

// Pré-calcul des longueurs cumulées
let segLen = [], cumLen = [0], total = 0;
for (let i=0;i<poly.length-1;i++) {
  const dx = poly[i+1][0]-poly[i][0], dy = poly[i+1][1]-poly[i][1];
  const L = Math.hypot(dx,dy); segLen.push(L); total += L; cumLen.push(total);
}

function pointAt(t) {
  const d = t*total;
  for (let i=0;i<segLen.length;i++) {
    if (d <= cumLen[i+1] || i === segLen.length-1) {
      const loc = (d - cumLen[i]) / (segLen[i] || 1e-9);
      const x = poly[i][0] + (poly[i+1][0]-poly[i][0]) * loc;
      const y = poly[i][1] + (poly[i+1][1]-poly[i][1]) * loc;
      return [x,y];
    }
  }
  return poly[poly.length-1];
}

const mapBox = document.getElementById('mapBox');
const marker = document.getElementById('marker');
const progress = document.getElementById('progress');
const kmVal = document.getElementById('kmVal');

function update() {
  const km = Number(progress.value);
  kmVal.textContent = km.toFixed(0);
  const t = km / Number(progress.max);
  const [nx,ny] = pointAt(t);
  const rect = mapBox.getBoundingClientRect();
  marker.style.left = (nx * rect.width) + 'px';
  marker.style.top  = (ny * rect.height) + 'px';
}

progress.addEventListener('input', update);
window.addEventListener('load', update);
window.addEventListener('resize', update);

// Cliquer/drag sur la carte pour déplacer le pointeur au plus proche du chemin
function setFromClient(x,y) {
  const r = mapBox.getBoundingClientRect();
  const px = (x - r.left)/r.width, py = (y - r.top)/r.height;
  let bestD = 1e9, bestAlong = 0;
  for (let i=0;i<poly.length-1;i++) {
    const x1=poly[i][0], y1=poly[i][1], x2=poly[i+1][0], y2=poly[i+1][1];
    const vx=x2-x1, vy=y2-y1, wx=px-x1, wy=py-y1;
    const c1=vx*wx+vy*wy, c2=vx*vx+vy*vy;
    let t = c2>0? Math.max(0, Math.min(1, c1/c2)) : 0;
    const projx=x1+vx*t, projy=y1+vy*t;
    const d=Math.hypot(projx-px,projy-py);
    const along=cumLen[i]+segLen[i]*t;
    if(d<bestD){bestD=d;bestAlong=along;}
  }
  const norm = bestAlong / total;
  progress.value = Math.round(norm * Number(progress.max));
  update();
}

mapBox.addEventListener('pointerdown', (e)=>{ mapBox.setPointerCapture(e.pointerId); setFromClient(e.clientX,e.clientY); });
mapBox.addEventListener('pointermove', (e)=>{ if(e.pressure>0) setFromClient(e.clientX,e.clientY); });
</script>
</body>
</html>
